# 🧹 完整清理指南

## 问题现象

即使删除了数据库，系统仍然显示旧的用户信息（Wesley / 大厨）

## 原因分析

用户信息可能缓存在多个地方：

1. ✅ 后端数据库
2. ✅ 前端本地存储
3. ⚠️ 微信开发者工具缓存
4. ⚠️ 编译后的代码

## 完整清理步骤

### 1️⃣ 清除后端数据库

```bash
cd backend
npm run db:clear
```

### 2️⃣ 清除前端编译缓存

```bash
cd my-new-project
rm -rf dist
npm run dev:weapp
```

### 3️⃣ 清除微信开发者工具缓存

在微信开发者工具中：

1. 点击顶部 "清缓存" → "清除工具授权数据"
2. 点击 "清缓存" → "清除文件缓存"
3. 点击 "清缓存" → "清除登录状态"
4. 点击 "清缓存" → "清除模拟器缓存"

### 4️⃣ 清除小程序本地存储

在小程序中：

1. 进入菜单页面
2. 点击 "🧹 清除缓存" 按钮
3. 确认清除

### 5️⃣ 重启所有服务

1. 重启后端服务
2. 重启微信开发者工具
3. 重新编译小程序

## ✅ 验证步骤

1. **检查数据库是否为空**

```bash
cd backend
node -e "const { PrismaClient } = require('@prisma/client'); const prisma = new PrismaClient(); prisma.user.findMany().then(users => { console.log('数据库中的用户:', users); prisma.\$disconnect(); });"
```

2. **检查前端缓存**
   在微信开发者工具控制台执行：

```javascript
console.log("OpenID:", Taro.getStorageSync("user_openid"));
console.log("所有缓存:", Taro.getStorageInfoSync());
```

3. **重新登录**

- 系统应该显示"新用户注册"
- 默认角色应该是"食客"
- 昵称应该是"微信用户"

## 🎯 设置大厨角色

1. 进入"干饭冠军"页面
2. 点击"🧪 缓存测试"
3. 点击"👑 设置用户角色"
4. 选择"设置为大厨"

## 💡 常见问题

### Q: 清除缓存后仍然显示旧信息

A: 请确保完成了所有 5 个步骤，特别是清除微信开发者工具缓存

### Q: 如何确认数据库已清空

A: 运行验证步骤 1，应该显示 `数据库中的用户: []`

### Q: 如何确认缓存已清除

A: 运行验证步骤 2，OpenID 应该是 `null` 或空

---

**最后提醒**：如果问题仍然存在，请尝试关闭微信开发者工具，删除 `dist` 目录，然后重新打开工具并编译。
